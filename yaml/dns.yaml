plugins:
  # ========== CloudFlare DNS ==========
  - tag: cloudflare
    type: forward
    args:
      concurrent: 3
      upstreams:
        # DoT
        - addr: "tls://1.1.1.1:853"
          enable_pipeline: true
        # DoH1.1
        - addr: "https://dns.cloudflare.com/dns-query"
          dial_addr: "1.1.1.1"
          enable_pipeline: true
        - addr: "https://security.cloudflare-dns.com/dns-query"
          dial_addr: "1.1.1.2"
          enable_pipeline: true
  
  # ========== Google DNS ==========
  - tag: google
    type: forward
    args:
      concurrent: 3
      upstreams:
        # 1. DoT 首选（TCP 853，抗干扰最强）
        - addr: "tls://8.8.4.4:853"
          enable_pipeline: true
        # DoH1.1
        - addr: "https://8.8.4.4/dns-query"
          enable_pipeline: true
        - addr: "https://dns.google/dns-query"
          dial_addr: "8.8.4.4"
          enable_pipeline: true

  # ========== 阿里DNS ==========
  - tag: ali
    type: forward
    args:
      concurrent: 3
      upstreams:
        # HTTP/3 优先（抗干扰最强）
        - addr: "https://dns.alidns.com/dns-query"
          dial_addr: "223.5.5.5"
          enable_http3: true
        
        # DoT 第二选择
        - addr: "tls://dns.alidns.com:853"
          dial_addr: "223.5.5.5"
          enable_pipeline: true
        
        # DoH1.1 作为备选
        - addr: "https://dns.alidns.com/dns-query"
          dial_addr: "223.5.5.5"
          enable_pipeline: true

# ========== 腾讯DNS (优化版) ==========
  - tag: dnspod
    type: forward
    args:
      concurrent: 2
      upstreams:
        # DoT 优先（速度快且稳定）
        - addr: "tls://dot.pub:853"
          dial_addr: "119.28.28.28"
          enable_pipeline: true
        
        # DoH 备选
        - addr: "https://doh.pub/dns-query"
          dial_addr: "119.28.28.28"
          enable_pipeline: true
  
  # local dns
  - tag: local
    type: forward
    args:
      concurrent: 1
      upstreams:
        - addr: 218.4.4.4 # 修改为自己运营商的 DNS
        - addr: 218.2.2.2 # 修改为自己运营商的 DNS

  # server 失败
  - tag: reject_2
    type: sequence
    args:
      - exec: reject 2

  # 拒绝响应
  - tag: reject_3
    type: sequence
    args:
      - exec: reject 3

  # 不支持的操作
  - tag: reject_5
    type: sequence
    args:
      - exec: reject 5
